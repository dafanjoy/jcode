package com.jcode.算法.轨迹比对.lcss;

import java.util.ArrayList;
import java.util.List;

/**
 * Hello world!
 *
 */
public class LCSS {
    private List<Coordinate> l1;
    private List<Coordinate> l2;
    private List<Coordinate> lcs = new ArrayList<>();

    public boolean isNearby(Coordinate a, Coordinate b) {
//        if (DistanceUtil.getDistance(a, b) < 50) return true;
//        return false;
    	
        double x_abs=Math.abs(a.x-b.x);
        double y_abs=Math.abs(a.y-b.y);
        if(x_abs<0.01&&y_abs<0.01)
            return true;
        return false;
    	
    }

    public void printLcs(int[][] flag, List<Coordinate> a, int i, int j) {
        if (i == 0 || j == 0) return;
        if (flag[i][j] == 1) {
            printLcs(flag, a, i - 1, j - 1);
            lcs.add(a.get(i - 1));
        } else if (flag[i][j] == 2) {
            printLcs(flag, a, i, j - 1);
        } else {
            printLcs(flag, a, i - 1, j);
        }
    }

    public double lcs(List<Coordinate> l1, List<Coordinate> l2) {
        int len1 = l1.size();
        int len2 = l2.size();
        int[][] c = new int[len1 + 1][len2 + 1];
        int[][] flag = new int[len1 + 1][len2 + 1];
        for (int i = 0; i < len1; i++) {
            for (int j = 0; j < len2; j++) {
                if (isNearby(l1.get(i), l2.get(j))) {
                    c[i + 1][j + 1] = c[i][j] + 1;
                    flag[i + 1][j + 1] = 1;//1='ok'
                } else if (c[i + 1][j] > c[i][j + 1]) {
                    c[i + 1][j + 1] = c[i + 1][j];
                    flag[i + 1][j + 1] = 2;//2='left'
                } else {
                    c[i + 1][j + 1] = c[i][j + 1];
                    flag[i + 1][j + 1] = 3;//3='up'
                }
            }
        }
        printLcs(flag, l1, len1, len2);
        double disper = 0.0699d;//距离偏差率
        double p = (lcs.size() * 1.0 / Math.min(len1, len2));
        if(p>0.7) {//如果说公共序列吻合率超过70%，增加距离偏差率惩罚
            //归一化处理
            p = p-p*(disper-0.01)*0.5;
        }
        return p;

    }

    public static void main(String[] args) {
        List<Coordinate> l1 = new ArrayList<>();
        String val1 = "112.404550,34.696210|112.404450,34.693700|112.404370,34.693210|112.404150,34.693120|112.399600,34.693720|112.395790,34.693990|112.394030,34.694370|112.393150,34.694290|112.392680,34.694450|112.380480,34.695570|112.378770,34.696080|112.375350,34.697750|112.370950,34.698960|112.369260,34.699260|112.343460,34.699380|112.341670,34.699510|112.341370,34.699880|112.341340,34.700850|112.340870,34.701560|112.340710,34.702910|112.340750,34.705140|112.340630,34.705230|112.340410,34.698650|112.340040,34.697050|112.339490,34.695910|112.338120,34.694300|112.330980,34.688100|112.329750,34.686310|112.329270,34.685180|112.327530,34.679090|112.327690,34.676180|112.327230,34.669900|112.327450,34.668390|112.327860,34.667410|112.337310,34.656420|112.340600,34.649170|112.355600,34.639300|112.360290,34.633610|112.369810,34.617180|112.370130,34.615730|112.371520,34.612350|112.371650,34.611620|112.370190,34.610680|112.369430,34.609950|112.365940,34.604860|112.364950,34.603820|112.364040,34.603300|112.337850,34.595740|112.334140,34.594360|112.328640,34.591730|112.326810,34.591050|112.310510,34.586810|112.303820,34.584610|112.302090,34.583560|112.296920,34.579160|112.296290,34.578810|112.282090,34.573420|112.278000,34.567820|112.269240,34.565450|112.260890,34.566060|112.253030,34.564420|112.240710,34.560290|112.239590,34.556840|112.243280,34.537250|112.243700,34.534080|112.240080,34.533590|112.237930,34.533020|112.231210,34.530600|112.230920,34.530380|112.230900,34.530150|112.230870,34.530010|112.230780,34.529920|112.230650,34.529860|112.230520,34.529890|112.230480,34.530080|112.230610,34.529880|112.230660,34.529740|112.230590,34.529640|112.230580,34.529720|112.230690,34.529730|112.230510,34.529600|112.230560,34.529690|112.230570,34.529690|112.230630,34.529670|112.230580,34.529730|112.230560,34.529810|112.230600,34.529890|112.230670,34.529930|112.230760,34.529950|112.230890,34.530060|112.230910,34.530290|112.230910,34.530290";
        String [] valarry1=val1.split("\\|");
        for(int i=0;i<valarry1.length;i++) {
        	String[] valarry2 = valarry1[i].split(",");
        	l1.add(new Coordinate(Double.valueOf(valarry2[0]),Double.valueOf(valarry2[1])));
        }
    
//        l1.add(new Coordinate(111.300, 30.1));
//        l1.add(new Coordinate(112.302, 30.101));
//        l1.add(new Coordinate(113.3023, 30.1002));
//        l1.add(new Coordinate(114.30235, 30.1011));
//        l1.add(new Coordinate(115.304, 30.1003));
//        l1.add(new Coordinate(116.304, 30.1003));
//        l1.add(new Coordinate(117.304, 30.1003));
//        l1.add(new Coordinate(118.304, 30.1003));
//        l1.add(new Coordinate(119.304, 30.1003));
//        l1.add(new Coordinate(120.304, 30.1003));
//        l1.add(new Coordinate(121.304, 30.1003));
        List<Coordinate> l2 = new ArrayList<>();
        String val2 = "112.403641,34.697646|112.403581,34.697286|112.403581,34.697286|112.404201,34.697237|112.404541,34.697238|112.404541,34.697238|112.404531,34.696759|112.404512,34.696099|112.404502,34.695849|112.404492,34.695670|112.404492,34.695520|112.404471,34.694951|112.404462,34.694371|112.404452,34.694101|112.404452,34.693242|112.404452,34.693242|112.403891,34.693251|112.403551,34.693290|112.402711,34.693369|112.402550,34.693378|112.401941,34.693478|112.401510,34.693526|112.401001,34.693585|112.400871,34.693595|112.400800,34.693605|112.399521,34.693731|112.399001,34.693779|112.398601,34.693819|112.398601,34.693819|112.398061,34.693876|112.397521,34.693925|112.397332,34.693934|112.396072,34.694030|112.395383,34.694098|112.394933,34.694136|112.394063,34.694213|112.393633,34.694261|112.393474,34.694270|112.393084,34.694309|112.392046,34.694424|112.391715,34.694454|112.391466,34.694482|112.390756,34.694549|112.389858,34.694625|112.389738,34.694634|112.388829,34.694741|112.387991,34.694826|112.387601,34.694875|112.387182,34.694903|112.386953,34.694931|112.385844,34.695056|112.385574,34.695084|112.384895,34.695151|112.384666,34.695169|112.384527,34.695179|112.383648,34.695265|112.383429,34.695283|112.382919,34.695331|112.382740,34.695349|112.382051,34.695416|112.381513,34.695473|112.380515,34.695587|112.380385,34.695558|112.379457,34.695802|112.378828,34.696018|112.378440,34.696186|112.377960,34.696454|112.377960,34.696454|112.377741,34.696563|112.376973,34.696968|112.376513,34.697195|112.376463,34.697265|112.375835,34.697541|112.375755,34.697571|112.374718,34.697896|112.374359,34.697994|112.374209,34.698043|112.374109,34.698073|112.373401,34.698259|112.373201,34.698308|112.371646,34.698729|112.371036,34.698887|112.370478,34.699043|112.369690,34.699170|112.368892,34.699226|112.368693,34.699245|112.366549,34.699267|112.366478,34.699266|112.365631,34.699263|112.365531,34.699263|112.364633,34.699259|112.364603,34.699259|112.363835,34.699257|112.363696,34.699256|112.362579,34.699252|112.361551,34.699259|112.361271,34.699259|112.360205,34.699246|112.358528,34.699242|112.357551,34.699239|112.356304,34.699237|112.355696,34.699246|112.353291,34.699244|112.352892,34.699244|112.352064,34.699243|112.350257,34.699244|112.349299,34.699234|112.346175,34.699228|112.344857,34.699230|112.343829,34.699222|112.343529,34.699224|112.343270,34.699224|112.343040,34.699225|112.342990,34.699225|112.342990,34.699225|112.342661,34.699226|112.342092,34.699357|112.341323,34.699370|112.341323,34.699370|112.341392,34.700298|112.341372,34.700599|112.341243,34.700839|112.340853,34.701260|112.340863,34.702029|112.340863,34.702029|112.340723,34.702409|112.340743,34.703608|112.340763,34.705086|112.340763,34.705366|112.340603,34.705397|112.340603,34.705397|112.340453,34.704978|112.340443,34.704648|112.340433,34.704259|112.340433,34.704259|112.340424,34.703579|112.340403,34.702540|112.340394,34.702060|112.340394,34.701781|112.340383,34.701451|112.340383,34.701451|112.340374,34.700781|112.340384,34.700322|112.340384,34.699383|112.340383,34.699093|112.340374,34.698903|112.340344,34.698523|112.340194,34.697705|112.340095,34.697396|112.339884,34.696827|112.339665,34.696369|112.339366,34.695880|112.339366,34.695880|112.339145,34.695542|112.338776,34.695063|112.338137,34.694377|112.337957,34.694218|112.336948,34.693362|112.336618,34.693095|112.336389,34.692905|112.336179,34.692737|112.335730,34.692359|112.335620,34.692270|112.335620,34.692270|112.335440,34.691881|112.334791,34.691335|112.334351,34.690957|112.332633,34.689498|112.332354,34.689250|112.332354,34.689250|112.332064,34.689002|112.331943,34.688893|112.331584,34.688576|112.331464,34.688467|112.331354,34.688357|112.331235,34.688238|112.331124,34.688128|112.331025,34.688010|112.330715,34.687662|112.330525,34.687423|112.330345,34.687185|112.329956,34.686578|112.329875,34.686458|112.329715,34.686160|112.329676,34.686079|112.329606,34.685950|112.329555,34.685841|112.329436,34.685561|112.329376,34.685432|112.329316,34.685293|112.329296,34.685243|112.329267,34.685133|112.328887,34.683947|112.328867,34.683887|112.328757,34.683518|112.328717,34.683379|112.328666,34.683239|112.328656,34.683209|112.328556,34.682859|112.328536,34.682810|112.328406,34.682371|112.328317,34.682082|112.328277,34.681933|112.328227,34.681793|112.328187,34.681634|112.328167,34.681564|112.328138,34.681484|112.328087,34.681295|112.328047,34.681185|112.327967,34.680906|112.327898,34.680686|112.327837,34.680496|112.327817,34.680427|112.327777,34.680267|112.327738,34.680148|112.327718,34.680068|112.327697,34.680008|112.327667,34.679858|112.327638,34.679749|112.327588,34.679549|112.327557,34.679419|112.327508,34.679120|112.327488,34.678821|112.327488,34.678361|112.327658,34.676781|112.327668,34.676332|112.327648,34.675822|112.327648,34.675652|112.327628,34.675413|112.327528,34.674105|112.327298,34.671019|112.327229,34.669920|112.327269,34.669082|112.327380,34.668521|112.327489,34.668161|112.327719,34.667599|112.327959,34.667148|112.328548,34.666355|112.328878,34.666004|112.329549,34.665420|112.331227,34.664120|112.332027,34.663486|112.332186,34.663365|112.332316,34.663264|112.332556,34.663074|112.332676,34.662983|112.333026,34.662701|112.333516,34.662328|112.333755,34.662138|112.334125,34.661846|112.334375,34.661645|112.334734,34.661323|112.334855,34.661222|112.334964,34.661112|112.335084,34.660992|112.335184,34.660881|112.335294,34.660760|112.335463,34.660570|112.335614,34.660399|112.335903,34.660009|112.335994,34.659878|112.336113,34.659708|112.336243,34.659497|112.336323,34.659367|112.336453,34.659156|112.336723,34.658626|112.336933,34.658115|112.337052,34.657785|112.337062,34.657745|112.337103,34.657625|112.337183,34.657335|112.337282,34.656904|112.337342,34.656615|112.337372,34.656265|112.337382,34.655985|112.337382,34.655855|112.337392,34.655716|112.337392,34.655556|112.337402,34.655415|112.337432,34.655086|112.337463,34.654796|112.337493,34.654576|112.337543,34.654236|112.337593,34.653906|112.337652,34.653626|112.337802,34.653126|112.337852,34.652976|112.337913,34.652826|112.337972,34.652666|112.338032,34.652516|112.338322,34.651945|112.338322,34.651945|112.338582,34.651504|112.338872,34.651093|112.340460,34.649179|112.340999,34.648578|112.341588,34.648016|112.341838,34.647796|112.342208,34.647494|112.342937,34.646974|112.343506,34.646592|112.345064,34.645849|112.345064,34.645849|112.345313,34.645739|112.345632,34.645588|112.345952,34.645428|112.346470,34.645197|112.347400,34.644746|112.347689,34.644606|112.347959,34.644476|112.349525,34.643725|112.349705,34.643645|112.350424,34.643235|112.350593,34.643135|112.351492,34.642646|112.352040,34.642276|112.352210,34.642146|112.352490,34.641947|112.352719,34.641767|112.353058,34.641517|112.353189,34.641417|112.353517,34.641168|112.353727,34.640987|112.354436,34.640399|112.355303,34.639571|112.355803,34.638992|112.356082,34.638662|112.356401,34.638294|112.356960,34.637635|112.357040,34.637545|112.357249,34.637305|112.357439,34.637076|112.358207,34.636149|112.358287,34.636039|112.358467,34.635800|112.358556,34.635690|112.358746,34.635480|112.359135,34.635052|112.359235,34.634922|112.364672,34.628275|112.364861,34.628085|112.366477,34.626043|112.367455,34.624529|112.367943,34.623691|112.368702,34.622086|112.368892,34.621637|112.369351,34.620101|112.369540,34.619252|112.369580,34.618702|112.369620,34.617933|112.369640,34.617773|112.369680,34.617544|112.369779,34.617075|112.369959,34.616507|112.370119,34.616017|112.370119,34.616017|112.370089,34.615687|112.370199,34.615388|112.370428,34.614870|112.370838,34.613833|112.370907,34.613644|112.370937,34.613564|112.371086,34.613184|112.371207,34.612895|112.371506,34.612178|112.371506,34.612178|112.371635,34.611709|112.371635,34.611709|112.371625,34.611599|112.371625,34.611599|112.371595,34.611499|112.371595,34.611499|112.371147,34.611277|112.370788,34.611085|112.370090,34.610542|112.369880,34.610362|112.369202,34.609618|112.369053,34.609428|112.368704,34.608868|112.368424,34.608456|112.367716,34.607414|112.367656,34.607324|112.367198,34.606643|112.366869,34.606162|112.366818,34.606092|112.366649,34.605851|112.366649,34.605851|112.366449,34.605551|112.366210,34.605220|112.366170,34.605150|112.365711,34.604488|112.365522,34.604268|112.365152,34.603927|112.365043,34.603827|112.364485,34.603455|112.363847,34.603143|112.363308,34.602961|112.361861,34.602548|112.361273,34.602376|112.360674,34.602204|112.360634,34.602194|112.360236,34.602073|112.359966,34.602003|112.359707,34.601922|112.358740,34.601649|112.357641,34.601338|112.356654,34.601036|112.355557,34.600736|112.355367,34.600685|112.353771,34.600224|112.352953,34.599984|112.352674,34.599903|112.352124,34.599753|112.350588,34.599304|112.350189,34.599194|112.349570,34.599024|112.349470,34.598995|112.349101,34.598885|112.348432,34.598696|112.348352,34.598676|112.347813,34.598526|112.347504,34.598437|112.346955,34.598277|112.346435,34.598128|112.344349,34.597533|112.344090,34.597454|112.342772,34.597068|112.342772,34.597068|112.342721,34.597058|112.341723,34.596761|112.340925,34.596534|112.339886,34.596228|112.338788,34.595893|112.336750,34.595302|112.335851,34.595026|112.335461,34.594868|112.335182,34.594749|112.334363,34.594384|112.332734,34.593654|112.331884,34.593239|112.331655,34.593121|112.331095,34.592833|112.328867,34.591769|112.327338,34.591199|112.326169,34.590808|112.325590,34.590632|112.325360,34.590574|112.324251,34.590282|112.324060,34.590233|112.324060,34.590233|112.323690,34.590136|112.322601,34.589854|112.321751,34.589641|112.321311,34.589525|112.321032,34.589457|112.319383,34.589039|112.318893,34.588914|112.318233,34.588749|112.316583,34.588342|112.316064,34.588205|112.315064,34.587964|112.314614,34.587847|112.314065,34.587712|112.312675,34.587372|112.312565,34.587343|112.312365,34.587295|112.312085,34.587217|112.310546,34.586839|112.310546,34.586839|112.309368,34.586518|112.308108,34.586127|112.306639,34.585677|112.306139,34.585521|112.305140,34.585197|112.304311,34.584863|112.303591,34.584508|112.303212,34.584301|112.302512,34.583895|112.301583,34.583281|112.301003,34.582804|112.300784,34.582596|112.300054,34.581951|112.299216,34.581195|112.298695,34.580739|112.298276,34.580372|112.297397,34.579596|112.296908,34.579248|112.296638,34.579080|112.295929,34.578774|112.295569,34.578665|112.294141,34.578321|112.293682,34.578212|112.293482,34.578163|112.291565,34.577720|112.291375,34.577681|112.291326,34.577671|112.289947,34.577365|112.289348,34.577167|112.288979,34.577017|112.288311,34.576729|112.288091,34.576639|112.288091,34.576639|112.287791,34.576510|112.287233,34.576271|112.287063,34.576201|112.283680,34.574736|112.282881,34.574287|112.282222,34.573767|112.282103,34.573677|112.282063,34.573618|112.282003,34.573547|112.280357,34.571209|112.279011,34.569309|112.279011,34.569309|112.277863,34.567689|112.277484,34.567319|112.277175,34.567079|112.277065,34.567009|112.276816,34.566849|112.276516,34.566659|112.275549,34.566357|112.275110,34.566296|112.273304,34.566052|112.273195,34.566042|112.272087,34.565889|112.272008,34.565879|112.271678,34.565828|112.270472,34.565655|112.270292,34.565624|112.269155,34.565451|112.268517,34.565369|112.267919,34.565277|112.266553,34.565271|112.265406,34.565447|112.265246,34.565466|112.264987,34.565505|112.262613,34.565865|112.261854,34.565972|112.261455,34.566030|112.261106,34.566087|112.260169,34.566174|112.259551,34.566150|112.258902,34.566127|112.258902,34.566127|112.258473,34.566085|112.258054,34.566024|112.258054,34.566024|112.257555,34.565942|112.257317,34.565870|112.256768,34.565707|112.256768,34.565707|112.256209,34.565535|112.255610,34.565333|112.255520,34.565303|112.255101,34.565160|112.254672,34.565019|112.254154,34.564846|112.254154,34.564846|112.253685,34.564684|112.253416,34.564602|112.253176,34.564521|112.252398,34.564258|112.251979,34.564106|112.250762,34.563700|112.250762,34.563700|112.250472,34.563599|112.250242,34.563518|112.249504,34.563265|112.249154,34.563143|112.248086,34.562769|112.247408,34.562546|112.247209,34.562475|112.245092,34.561757|112.244333,34.561474|112.244144,34.561412|112.243914,34.561332|112.243795,34.561301|112.243285,34.561120|112.243285,34.561120|112.241357,34.560482|112.240938,34.560341|112.240938,34.560341|112.240679,34.560251|112.240019,34.560028|112.239430,34.559826|112.239430,34.559826|112.239140,34.559726|112.239020,34.559685|112.239030,34.559605|112.239030,34.559605|112.239090,34.559305|112.239090,34.559305|112.239220,34.558616|112.239260,34.558357|112.239510,34.557008|112.239800,34.555481|112.240080,34.553993|112.240199,34.553334|112.240219,34.553244|112.240309,34.552745|112.240490,34.551786|112.240550,34.551437|112.240550,34.551437|112.240730,34.550528|112.240940,34.549400|112.240950,34.549360|112.240960,34.549269|112.241189,34.548072|112.241189,34.548072|112.241399,34.547013|112.241559,34.546134|112.241729,34.545256|112.241909,34.544317|112.241949,34.544088|112.241949,34.544088|112.242009,34.543778|112.242129,34.543149|112.243018,34.538246|112.243038,34.538126|112.243048,34.538057|112.243068,34.537937|112.243088,34.537846|112.243218,34.537098|112.243458,34.535760|112.243758,34.534032|112.243828,34.533922|112.243828,34.533922|112.242050,34.533745|112.239993,34.533478|112.239883,34.533458|112.239233,34.533316|112.238075,34.532933|112.237964,34.532892|112.236326,34.532308|112.236216,34.532268|112.235196,34.531906|112.235097,34.531875|112.233207,34.531202|112.233108,34.531161|112.231338,34.530529|112.231238,34.530498|112.231238,34.530498|112.231368,34.529909|112.231368,34.529909|112.230758,34.529728";
        String [] valarry2=val2.split("\\|");
        for(int i=0;i<valarry2.length;i++) {
        	String[] valarry22 = valarry2[i].split(",");
        	l2.add(new Coordinate(Double.valueOf(valarry22[0]),Double.valueOf(valarry22[1])));
        }

//        l2.add(new Coordinate(121.304, 30.1003));
//        l2.add(new Coordinate(120.304, 30.1003));
//        l2.add(new Coordinate(119.304, 30.1003));
//        l2.add(new Coordinate(118.304, 30.1003));
//        l2.add(new Coordinate(117.304, 30.1003));
//        l2.add(new Coordinate(116.304, 30.1003));
//        l2.add(new Coordinate(111.300, 30.1));
//        l2.add(new Coordinate(112.302, 30.101));
//        l2.add(new Coordinate(113.3023, 30.1002));
//        l2.add(new Coordinate(114.30235, 30.1011));
//        l2.add(new Coordinate(115.304, 30.1003));







        LCSS lcss = new LCSS();
        System.out.println(lcss.lcs(l1, l2));
    }
}

